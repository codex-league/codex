<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script src="/webjars/jquery/3.1.1/jquery.min.js"></script>
    <script src="/webjars/bootstrap/3.3.7-1/js/bootstrap.min.js"></script>
    <script src="/webjars/vue/2.5.17/dist/vue.min.js"></script>
    <script src="/webjars/vue-resource/1.5.1/dist/vue-resource.js"></script>
    <script src="/webjars/element-ui/2.4.8/lib/index.js"></script>

    <title>Code-X Thanos版 </title>

    <link rel="stylesheet" href="/webjars/element-ui/2.4.8/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="/webjars/bootstrap/3.3.7-1/css/bootstrap.min.css"/>

    <link rel="stylesheet" href="css/common.css"/>
    <link rel="stylesheet" href="css/head.css"/>
    <link rel="stylesheet" href="css/foot.css"/>
    <link rel="stylesheet" href="css/generate.css"/>

</head>
<body>
<div id="index">
    <div class="container">
        <div class="head_block head_block_grey">
        <span class="logo">
            <img src="images/logo.png">
        </span>
            <ul>
                <li><a href="index.html">关于我们</a></li>
                <li class="active">代码生成</li>
                <li><a href="api.html">API-X</a></li>
                <li><a href="regular.html">正则工具</a></li>
                <li><a href="codejson.html">JSON校验工具</a></li>
            </ul>
        </div>
    </div>

    <hr class="hr_top"/>

    <div class="container container_body">
        <el-row>
            <el-col :span="10" class="boundary_left">
                <div class="table">
                    <table>
                        <tr>
                            <th>表名</th>
                            <th>注释</th>
                        </tr>
                        <tr v-for="(item, index) in tableList" @click="intTableOptions(item)">
                            <td>{{ item.tableName }}</td>
                            <td>{{ item.tableComment }}</td>
                        </tr>
                    </table>
                </div>
            </el-col>
            <el-col :span="14" class="boundary_right">

                <div>
                    <span class="title">准备生成CRUD</span>
                    <el-card shadow="never">
                        <div class="crud_option">
                            <el-form label-width="150px" size="mini"
                                     border>
                                <el-form-item label="表名：">
                                    <span v-if="activeTable" style="font-size: 16px; font-weight: 500">{{ activeTable.tableName }}</span>
                                </el-form-item>
                                <el-form-item label="表注释：">
                                    <span v-if="activeTable"
                                          style="font-size: 14px">{{ activeTable.tableComment }}</span>
                                </el-form-item>

                                <el-form-item label="忽略的前缀">
                                    <el-radio-group>
                                        <el-radio v-if="activeTable" v-for="(item, index) in prefix" border>{{ item }}
                                        </el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                <el-form-item label="是否生成Controller:">
                                    <el-radio-group v-model="isCtrlGenerate">
                                        <el-radio label="1" border>是</el-radio>
                                        <el-radio label="2" border>否</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                <el-form-item label="生成接口:" required>
                                    <el-checkbox-group v-model="checkoutInterface" @change="handleCheckInterface">
                                        <el-checkbox v-for="(item, key) in interfaces" :label="key"> {{ item }}
                                        </el-checkbox>
                                    </el-checkbox-group>
                                </el-form-item>
                            </el-form>
                        </div>
                    </el-card>
                </div>

                <div>
                    <span class="title">接口预览</span>
                    <div class="preview_option">
                        <el-collapse v-model="activeName" accordion>
                            <el-collapse-item title="新增接口" name="1" v-if="controllerContainer.add">
                                <table class="preview_table">
                                    <tr>
                                        <th width="10%">类型</th>
                                        <th>字段名称</th>
                                        <th width="20%">注释</th>
                                        <th width="20%">注解</th>
                                    </tr>
                                    <tr v-for="(field, index) in controllerContainer.add.fields" v-key="index">
                                        <td>{{ field.attrType }}</td>
                                        <td>{{ field.attrname }}</td>
                                        <td>{{ field.comments}}</td>
                                        <td>注解</td>
                                    </tr>
                                </table>
                            </el-collapse-item>
                            <el-collapse-item title="更新接口" name="2" v-if="controllerContainer.update">
                                <table class="preview_table">
                                    <tr>
                                        <th width="10%">类型</th>
                                        <th>字段名称</th>
                                        <th width="20%">注释</th>
                                        <th width="20%">注解</th>
                                    </tr>
                                    <tr v-for="(field, index) in controllerContainer.update.fields" v-key="index">
                                        <td>{{ field.attrType }}</td>
                                        <td>{{ field.attrname }}</td>
                                        <td>{{ field.comments}}</td>
                                        <td>注解</td>
                                    </tr>
                                </table>
                            </el-collapse-item>
                            <el-collapse-item title="删除接口" name="3" v-if="controllerContainer.del">
                                无需设置
                            </el-collapse-item>
                            <el-collapse-item title="详情接口" name="4" v-if="controllerContainer.detail">
                                无需设置
                            </el-collapse-item>
                            <el-collapse-item title="列表接口（分页）" name="5" v-if="controllerContainer.list">
                                无需设置
                            </el-collapse-item>
                        </el-collapse>
                    </div>
                </div>

                <div class="generate_button">
                    <el-button type="primary" @click="generate">生成代码</el-button>
                </div>
            </el-col>
        </el-row>
    </div>

    <div class="bottom_block">
        <div>欢迎关注Github：<a href="https://github.com/codex-league/codex"> https://github.com/codex-league/codex </a>
        </div>
        <div>使用帮助请移步至 <a href="https://github.com/codex-league/codex"> https://github.com/codex-league/codex </a></div>
        <div>使用请遵循Apache开源协议，开源产品非任何组织和个人独自拥有</div>
    </div>
</div>
</body>
</html>

<script>
    new Vue({
        el: '#index',
        data: {
            interfaces: {
                add: "增加",
                update: "修改",
                del: "删除",
                detail: "详情",
                list: "列表"
            },
            checkoutInterface: [],
            activeName: undefined,
            tableList: undefined,
            attributes: undefined,
            package: undefined,
            prefix: undefined,
            activeTable: undefined,
            isCtrlGenerate: '1',
            controllerContainer: {}
        },
        methods: {
            intTableOptions(table) {
                this.activeTable = table;

                Vue.http.get('/codex/generate/table/attribute/detail/' + table.tableName).then(fulfilled => {
                    if (fulfilled.ok) {
                        const {attributes} = fulfilled.data;

                        this.attributes = attributes;

                        console.log(attributes)

                    }

                })
            },
            handleCheckInterface(controllerKeys) {

                for (const key in this.interfaces) {
                    if (!this.controllerContainer[key] && controllerKeys.indexOf(key) !== -1 ) {
                        this.$set(this.controllerContainer, key, {
                            fields: JSON.parse(JSON.stringify(this.attributes))
                        })
                    }

                    if(controllerKeys.indexOf(key) === -1) {
                        this.$delete(this.controllerContainer, key)
                    }
                }
            },
            generate() {
                console.log(this.checkoutInterface)
            }
        },
        created() {
            Vue.http.get('/codex/generate/table/option').then(fulfilled => {
                if (fulfilled.ok) {
                    const {jdbc, tableList, package, prefix} = fulfilled.data;
                    this.tableList = tableList;
                    this.package = package;
                    this.prefix = prefix.split(',');

                    if (tableList.length > 0) {
                        this.intTableOptions(tableList[0])
                    }
                }
            }, () => {
                this.$message.error('获取配置选项失败，请检查配置是否正确！');
            })

        }
    });
</script>


